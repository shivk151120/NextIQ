{% extends 'core/base.html' %}
{% block content %}
<div class="container mt-5">
  <h3>Student Dashboard</h3>
  <p>Welcome, {{ request.user.username }}!</p>

  <!-- Points & Badges -->
  <div class="mb-4">
    <h5>Your Points: <span class="badge bg-primary">{{ total_points }}</span></h5>
    <h5>Your Badges:</h5>
    {% if request.user.badges.all %}
      {% for badge in request.user.badges.all %}
        <span class="badge bg-success me-1 mb-1">{{ badge.name }}</span>
      {% endfor %}
    {% else %}
      <span>No badges yet</span>
    {% endif %}
  </div>

  <!-- Your Practice Phrases -->
  <h5 class="mt-4">Your Practice Phrases:</h5>
  <ul class="list-group mb-4">
    {% for phrase in phrases %}
      <li class="list-group-item">
        <div class="d-flex justify-content-between align-items-center">
          <span>{{ phrase.text }}</span>
          <a href="{% url 'practice' phrase.id %}" class="btn btn-primary btn-sm">Practice</a>
        </div>

        <!-- Social Share Buttons -->
        <div class="mt-2">
          <a href="https://twitter.com/intent/tweet?text={{ phrase.text }}"
             target="_blank" class="btn btn-info btn-sm me-1">Twitter</a>
          <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri }}"
             target="_blank" class="btn btn-primary btn-sm me-1">Facebook</a>
          <a href="mailto:?subject=Check this phrase&body={{ phrase.text }}"
             class="btn btn-secondary btn-sm">Email</a>
        </div>
      </li>
    {% empty %}
      <li class="list-group-item">No phrases available.</li>
    {% endfor %}
  </ul>

  <!-- Personal Leaderboard / Attempts -->
  <h5 class="mt-4">Your Attempts & Progress</h5>
  <table class="table table-striped table-bordered">
    <thead class="table-dark">
      <tr>
        <th>Phrase</th>
        <th>Time Taken (sec)</th>
        <th>Correct?</th>
        <th>Date</th>
      </tr>
    </thead>
    <tbody>
      {% for attempt in attempts %}
      <tr class="{% if attempt.is_correct %}table-success{% else %}table-danger{% endif %}">
        <td>{{ attempt.phrase.text }}</td>
        <td>{{ attempt.time_taken }}</td>
        <td>{% if attempt.is_correct %}✔{% else %}✖{% endif %}</td>
        <td>{{ attempt.attempt_date|date:"d M Y H:i" }}</td>
      </tr>
      {% empty %}
      <tr><td colspan="4">You haven't attempted any phrases yet.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
